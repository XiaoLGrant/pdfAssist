<%- include('partials/header') -%>
<%- include('partials/navbarLoggedIn') -%>

    <section class="p-5 bg-primary text-light">
        <div class="container">
            <h1>TX Citation Request</h1>
        </div>
    </section>

    <section class="p-4 bg-light">
        <div class="container bg-body rounded-4 p-4">
            <section class="instructions">
                <h2>Instructions <i class="fa-solid fa-angle-down"></i></h2>
                <div class="instructions hidden">
                    <p>Fill out the case and template information fields below, then click Create PDF. Some things to note:</p>
                    <ul>
                        <li>Trailing and preceding spaces in the court info field are okay. Data must be formatted as follows:<br>
                            Court Name<br>
                            12345 Main St<br>
                            City, State 12345</li>
                        <li>Servee addresses must be formatted as follows:<br>
                            12345 Main St<br>
                            City, State 12345</li>
                        <li>There is only space for two servees. If you need more than two aliases for a case you'll need to generate additional cover letters.</li>
                        <li>If sheriff or constable are selected for service type, you do not need to select doc return method or customer email.</li>
                        <li>If email is selected as the doc return method, then a customer email must be selected from the dropdown. Otherwise, customer email does not need to be selected.</li>
                        <li>You can click the reset button or refresh the page to clear the form fields, but you do not need to in order to generate another letter.</li>
                    </ul>
                </div>
            </section>

            <section hidden>
                <input type="hidden" id="signature" value="<%= user[0].businessName %>">
                <textarea id="retAdd1">
                    <%= user[0].businessName.toUpperCase() %>**Address: <%= user[0].address1 %>, <%= user[0].address2 %> <%= user[0].city %>, <%= user[0].state %> <%= user[0].zip %>**<% if(user[0].phone !== '') {%>Phone: <%= user[0].phone %><% } %>
                </textarea>
                <% if(user[0].returnAddress2 !== '') {%>
                    <textarea id="retAdd2">
                        <% user[0].returnAddress2.split('\n').forEach(line => { %>
                            <%= line %>**
                        <% }) %>
                    </textarea>
                <% } %>
            </section>

            <section class="txLetterForm">
                <div class="row">
                    <div class="col-3 inputPreview border" id="inputPreview2">
                        <div class="inputFields col">
                            <fieldset class="txCourtCaseInfo">
                                <legend>Case Information</legend>
                                <fieldset>
                                    <legend>Court Information</legend>
                                    <label for="courtInfo">Court Info: </label>
                                    <textarea class="form-control" name="courtInfo" id="courtInfo" placeholder="TX Precinct 2 Place 2 Justice Court for Cameron County&#10;12345 Main St&#10;City, State 12345">TX Precinct 2 Place 2 Justice Court for Cameron County&#10;12345 Main St&#10;City, State 12345</textarea>
                                </fieldset>
    
                                <fieldset>
                                    <legend>Case Identifiers</legend>
                                    <label for="matterNumber">Matter Number: </label>
                                    <input class="form-control" name="matterNumber" id="matterNumber" value="123456789">
                                    
                                    <label for="caseNum">Case Number: </label>
                                    <input class="form-control" name="caseNum" id="caseNum" value="22SC123456">
                                </fieldset>
                
                                <fieldset>
                                    <legend>Party Information</legend>
                                    <label for="plaintiffName">Plaintiff Name(s): </label>
                                    <input class="form-control" name="plaintiffName" id="plaintiffName" placeholder="Name1, Name2, etc." value="Doggerson LLC">
                                    
                                    <label for="defendantName">Defendant Name(s): </label>
                                    <input class="form-control" name="defendantName" id="defendantName" placeholder="Name1, Name2, etc." value="Cat Llama">
                                    
                                    <label for="servee1Name">Servee 1 Name: </label>
                                    <input class="form-control" name="servee1Name" id="servee1Name" value="Cat Llama">
                                    
                                    <label for="servee1Address">Servee 1 Address: </label>
                                    <textarea class="form-control" name="servee1Address" id="servee1Address" placeholder="12345 Main St&#10;City, State 12345">12345 Main St&#10;City, State 12345</textarea>
                        
                                    <label for="servee2Name">Servee 2 Name: </label>
                                    <input class="form-control" name="servee2Name" id="servee2Name">
                                    
                                    <label for="servee2Address">Servee 2 Address: </label>
                                    <textarea class="form-control" name="servee2Address" id="servee2Address" placeholder="12345 Main St&#10;City, State 12345"></textarea>
                                </fieldset>
                            </fieldset>
        
                            <fieldset class="templateInfo">
                                <legend>Template Information</legend>
                                <fieldset class="txServiceDocReturn">
                                    <legend>Service & Return Method</legend>
                                    <label for="txServiceType">Service Method</label>
                                    <select class="form-select" name="txServiceType" id="txServiceType" aria-label="Select service method">
                                        <option value="">Choose an option</option>
                                        <option value="private process server">Private Process Server</option>
                                        <option value="sheriff">Sheriff</option>
                                        <option value="constable">Constable</option>
                                    </select>
                    
                                    <label for="txDocReturnMethod">Doc Return Method</label>
                                    <select class="form-select" name="txDocReturnMethod" id="txDocReturnMethod" aria-label="Select document return method">
                                        <option value="">Choose an option</option>
                                        <option value="Mail to <%= user[0].businessName %> at <%= user[0].address1 %><% if(user[0].address2.length !== 0) { %><%= user[0].address2 %><% } %> <%= user[0].city %>, <%= user[0].state %> <%= user[0].zip %>">Mail</option>
                                        <option value="Hold for pickup by local <%= user[0].businessName %> courier">Hold for pickup</option>
                                        <option value="Email to ">Email to </option>
                                    </select>
                                
                                    <label for="customerEmail">Customer Email</label>
                                    <select class="form-select" name="customerEmail" id="customerEmail" aria-label="Select customer email">
                                        <option value="">Choose a customer</option>
                                        <% customerList.forEach(customer => { %>
                                            <option value="<%= customer._id %>"><%= customer.customerName %></option>
                                        <% }) %>
                                    </select>
                                </fieldset>

                                <label for="txAliasTemplate">Template</label>
                                <select name="txAliasTemplate" id="txAliasTemplate">
                                    <option value="">Choose an option</option>
                                    <% templates.forEach(template => { %>
                                        <option value="<%= template.file %>"><%= template.templateType %></option>
                                    <% }) %>
                                </select>

                                <input type="hidden" name="generateDate">
                            </fieldset>

                            <div class="row">
                                <div class="col">
                                    <button class="btn btn-primary btn-sm" id="create">Create PDF</button>
                                    <span class="btn btn-secondary btn-sm" id="resetTxLetForm">Reset</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col border">
                        <iframe id="pdfPreview" src=""></iframe>
                    </div>
                </div>
            </section>
        </div>
    </section>

    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://unpkg.com/downloadjs@1.4.7"></script>
    <script src="js/createTxAlias.js"></script>

<%- include('partials/footer') -%>